<!DOCTYPE html>
<html>
<head>
<title>Slapjack</title>
<canvas id='drawcard' width="600" height="400" onclick = 'play()'></canvas>
<script src="/socket.io/socket.io.js"> var client=io(); </script>
    <style>
        body {background-color:lightblue}
        h1   {color:forestgreen}
        p    {color:green}
    </style>
</head>
<body>
<h1 style="font-family:trebuchet MS">Register</h1>
Your name: <input id="name">
<button id = 'register' onclick='register()'> Register</button>
<script>
    function play(){
        console.log(my_name+" played.");
        //if(my_name == active_player){
        client.emit('play', my_name);
        //}
    }
    var my_name;
    var cards = ['1.png', '2.png', '3.png', '4.png', '5.png', '6.png', '7.png', '8.png', '9.png', '10.png', '11.png', '12.png', '13.png', '14.png', '15.png', '16.png', '17.png', '18.png', '19.png', '20.png', '21.png', '22.png', '23.png', '24.png', '25.png', '26.png', '27.png', '28.png', '29.png', '30.png', '31.png', '32.png', '33.png', '34.png', '35.png', '36.png', '37.png', '38.png', '39.png', '40.png', '41.png', '42.png', '43.png', '44.png', '45.png', '46.png', '47.png', '48.png', '49.png', '50.png', '51.png', '52.png'];
    var active_player;
    var cardImages = {};
        for(var i=0; i<cards.length; i++){
            var img = new Image();
            img.src='/images/' + cards[i];
            cardImages[cards[i]] = img;
        }
    var client=io();
    var ctx = document.getElementById('drawcard').getContext('2d');
    var hiddenCard = new Image();
    hiddenCard.src = '/images/b1fv.png';
    function register(){
        my_name = document.getElementById('name').value;
        client.emit('register', {player:my_name});
        console.log("emit register msg for "+my_name)
    }
    client.on('announce', function(data){
        //console.log(data);
        document.getElementById('status').innerHTML+= '<br>' + data;

    });
    client.on('deal', function (data){
        console.log(data);

        ctx.clearRect(0, 0, 600, 400);

        //draw hands
        for(var i=0; i < 4; i +=2){
            for(var j=0; j < data.players[i+1]; j +=1){
                ctx.drawImage(hiddenCard, 10 + 10 * j, 10 + i * 100)

            }
        }

        //draw pile
        var x_offset = 10;
        for(var i=0; i<data.pile.length; i++){
            x_offset += 10;
            var img = new Image();
            var cardname =  data.pile [i];
            var img = cardImages[cardname];
            console.log(img);
            ctx.drawImage(img, 10 + 50 * i, 110);
        }
        active_player = data.active_player;
    });
</script>
<div id='status'> </div>
</body>
</html>